# üöÄ ServeRest API Test Automation

[![Node.js](https://img.shields.io/badge/Node.js-18+-green.svg)](https://nodejs.org/)
[![Cypress](https://img.shields.io/badge/Cypress-13.6.3-blue.svg)](https://www.cypress.io/)
[![JavaScript](https://img.shields.io/badge/JavaScript-ESM-yellow.svg)](https://developer.mozilla.org/en-US/docs/Web/JavaScript)
[![License](https://img.shields.io/badge/License-ISC-blue.svg)](LICENSE)

Projeto de automa√ß√£o de testes de API para o [ServeRest](https://serverest.dev) utilizando Cypress, seguindo as melhores pr√°ticas de engenharia de qualidade de software.

---

## üìã √çndice

- [Sobre o Projeto](#-sobre-o-projeto)
- [Objetivos](#-objetivos)
- [Ferramentas e Tecnologias](#-ferramentas-e-tecnologias)
- [Arquitetura e Estrutura](#-arquitetura-e-estrutura)
- [Melhores Pr√°ticas Implementadas](#-melhores-pr√°ticas-implementadas)
- [Pr√©-requisitos](#-pr√©-requisitos)
- [Instala√ß√£o](#-instala√ß√£o)
- [Configura√ß√£o](#-configura√ß√£o)
- [Executando os Testes](#-executando-os-testes)
- [Estrutura dos Testes](#-estrutura-dos-testes)
- [Relat√≥rios](#-relat√≥rios)
- [Padr√µes de C√≥digo](#-padr√µes-de-c√≥digo)
- [Exemplos de Uso](#-exemplos-de-uso)

---

## üéØ Sobre o Projeto

Este projeto implementa uma su√≠te completa de testes automatizados para a API REST do ServeRest, focando em:

- ‚úÖ **Cobertura de endpoints**: POST, GET, GET by ID, DELETE para `/usuarios`
- ‚úÖ **Testes negativos e positivos**: Valida√ß√£o de casos de erro e sucesso
- ‚úÖ **Valida√ß√£o de contratos**: Schemas JSON validados com AJV
- ‚úÖ **Valida√ß√£o de headers**: Verifica√ß√£o de seguran√ßa e qualidade
- ‚úÖ **Isolamento de dados**: Fixtures e setup automatizado
- ‚úÖ **Relat√≥rios detalhados**: Allure Reports para an√°lise e rastreabilidade

---

## üéØ Objetivos

### Principais

1. **Qualidade e Confiabilidade**: Garantir que a API funcione conforme esperado atrav√©s de testes automatizados
2. **Valida√ß√£o de Contrato**: Verificar que as respostas da API seguem os contratos definidos (schemas)
3. **Cobertura de Cen√°rios**: Testar tanto casos de sucesso quanto casos de erro (negativos)
4. **Manutenibilidade**: C√≥digo limpo, organizado e f√°cil de manter
5. **Rastreabilidade**: Relat√≥rios detalhados para an√°lise de resultados

### T√©cnicos

- Implementar padr√£o **AAA** (Arrange-Act-Assert) em todos os testes
- Centralizar helpers e fun√ß√µes reutiliz√°veis
- Eliminar duplica√ß√£o de c√≥digo (princ√≠pio DRY)
- Garantir execu√ß√£o r√°pida e est√°vel dos testes
- Facilitar onboarding de novos membros do time

---

## üõ† Ferramentas e Tecnologias

### Core

| Ferramenta | Vers√£o | Prop√≥sito |
|------------|--------|-----------|
| [Node.js](https://nodejs.org/) | ‚â•18 | Runtime JavaScript |
| [Cypress](https://www.cypress.io/) | 13.6.3 | Framework de automa√ß√£o de testes E2E |
| [JavaScript (ESM)](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Guide/Modules) | ES6+ | Linguagem de programa√ß√£o |
| [AJV](https://ajv.js.org/) | 8.12.0 | Valida√ß√£o de schemas JSON |

### Relat√≥rios e Plugins

| Ferramenta | Vers√£o | Prop√≥sito |
|------------|--------|-----------|
| [Allure Report](https://docs.qameta.io/allure/) | 2.34.1 | Gera√ß√£o de relat√≥rios detalhados |
| [@shelex/cypress-allure-plugin](https://github.com/Shelex/cypress-allure-plugin) | 2.41.2 | Integra√ß√£o Allure com Cypress |
| [dotenv](https://www.npmjs.com/package/dotenv) | - | Gerenciamento de vari√°veis de ambiente |

### Utilit√°rios

| Ferramenta | Vers√£o | Prop√≥sito |
|------------|--------|-----------|
| [rimraf](https://www.npmjs.com/package/rimraf) | 6.0.1 | Limpeza de diret√≥rios (cross-platform) |

---

## üìÅ Arquitetura e Estrutura

### Estrutura de Diret√≥rios

```
serverest-api-e2e-test-automation/
‚îÇ
‚îú‚îÄ‚îÄ cypress/                          # Diret√≥rio principal do Cypress
‚îÇ   ‚îú‚îÄ‚îÄ e2e/                         # Testes end-to-end
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ 1-post.usuarios.spec.cy.js
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ 2-get.usuarios.spec.cy.js
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ 3-get.usuario.byid.spec.cy.js
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ 4-delete.usuarios.spec.cy.js
‚îÇ   ‚îÇ
‚îÇ   ‚îú‚îÄ‚îÄ fixtures/                    # Dados de teste e schemas
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ schema/                  # Schemas JSON Schema
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ usuario.create.success.schema.json
‚îÇ   ‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ usuario.create.emailInUse.schema.json
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ usuarios.create.cases.json
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ usuarios.test.data.json
‚îÇ   ‚îÇ
‚îÇ   ‚îú‚îÄ‚îÄ support/                     # Helpers e configura√ß√µes
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ e2e.js                   # Configura√ß√£o global Cypress
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ helpers.js               # Helpers centralizados ‚≠ê
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ setup.usuarios.js        # Setup para cria√ß√£o de dados
‚îÇ   ‚îÇ
‚îÇ   ‚îú‚îÄ‚îÄ screenshots/                 # Screenshots (quando necess√°rio)
‚îÇ   ‚îî‚îÄ‚îÄ videos/                      # V√≠deos (desabilitado)
‚îÇ
‚îú‚îÄ‚îÄ reports/                         # Relat√≥rios gerados
‚îÇ   ‚îú‚îÄ‚îÄ allure-results/              # Resultados brutos do Allure
‚îÇ   ‚îî‚îÄ‚îÄ allure-report/               # Relat√≥rio HTML gerado
‚îÇ
‚îú‚îÄ‚îÄ cypress.config.js                # Configura√ß√£o do Cypress
‚îú‚îÄ‚îÄ package.json                     # Depend√™ncias e scripts npm
‚îú‚îÄ‚îÄ .env.example                     # Template de vari√°veis de ambiente
‚îî‚îÄ‚îÄ README.md                        # Este arquivo
```

### Organiza√ß√£o dos Testes

Os testes seguem uma nomenclatura num√©rica para garantir ordem de execu√ß√£o:

- `1-post.usuarios.spec.cy.js` - Testes de cria√ß√£o (POST)
- `2-get.usuarios.spec.cy.js` - Testes de listagem (GET)
- `3-get.usuario.byid.spec.cy.js` - Testes de busca por ID (GET)
- `4-delete.usuarios.spec.cy.js` - Testes de exclus√£o (DELETE)

### Fluxo de Execu√ß√£o

```
1. Clean (limpa resultados anteriores)
   ‚Üì
2. Execu√ß√£o dos testes (Cypress + Electron headless)
   ‚Üì
3. Coleta de resultados (Allure)
   ‚Üì
4. Gera√ß√£o do relat√≥rio HTML
   ‚Üì
5. Abertura autom√°tica no navegador
```

---

## ‚ú® Melhores Pr√°ticas Implementadas

### 1. **Padr√£o AAA (Arrange-Act-Assert)**

Todos os testes seguem o padr√£o AAA para clareza e organiza√ß√£o:

```javascript
it('CT-001 ‚Äî [400] E-mail j√° cadastrado @negative', () => {
  // Arrange - Preparar dados
  const payload = fx.CT001_duplicate;
  
  // Act - Executar a√ß√£o
  cy.request({ method: 'POST', url: '/usuarios', body: payload, failOnStatusCode: false })
    .then((res) => {
      // Assert - Validar resultado
      expect(res.status).to.eq(400);
      assertTypicalJsonHeaders(res.headers);
      validateSchema(res.body, schemaEmailInUse);
    });
});
```

### 2. **DRY (Don't Repeat Yourself)**

Helpers centralizados em `cypress/support/helpers.js`:

- ‚úÖ `assertTypicalJsonHeaders()` - Valida√ß√£o de headers JSON
- ‚úÖ `validateSchema()` - Valida√ß√£o de schemas com AJV
- ‚úÖ `generateUniqueEmail()` - Gera√ß√£o de emails √∫nicos

### 3. **Separa√ß√£o de Responsabilidades**

- **Fixtures**: Dados de teste isolados
- **Support/Helpers**: Fun√ß√µes reutiliz√°veis
- **Support/Setup**: Cria√ß√£o autom√°tica de dados para testes
- **Specs**: Apenas l√≥gica de teste

### 4. **Valida√ß√£o de Contrato**

Valida√ß√£o de schemas JSON usando AJV para garantir conformidade com o contrato da API:

```javascript
validateSchema(res.body, schemaSuccess);
```

### 5. **Isolamento de Testes**

- Dados √∫nicos usando `Date.now()` ou fun√ß√µes helper
- Setup/teardown controlado via hooks do Cypress
- Fixtures para dados est√°ticos

### 6. **Nomenclatura Descritiva**

- Testes com t√≠tulos descritivos e c√≥digos (CT-XXX)
- Tags para organiza√ß√£o (`@positive`, `@negative`, `@smoke`)
- Coment√°rios claros nos blocos AAA

### 7. **Configura√ß√£o Centralizada**

- Vari√°veis de ambiente via `.env`
- Configura√ß√£o do Cypress em `cypress.config.js`
- Base URL configur√°vel

---

## üì¶ Pr√©-requisitos

Antes de come√ßar, certifique-se de ter instalado:

- **Node.js** ‚â• 18.x ([Download](https://nodejs.org/))
- **npm** (inclu√≠do com Node.js) ou **yarn**
- **Git** ([Download](https://git-scm.com/))

### Verificar instala√ß√µes

```bash
node --version  # Deve retornar v18.x ou superior
npm --version   # Deve retornar 9.x ou superior
git --version   # Qualquer vers√£o recente
```

---

## üì• Instala√ß√£o

### 1. Clone o reposit√≥rio

```bash
git clone https://github.com/thitoribeiro/serverest-api-e2e-test-automation.git
cd serverest-api-e2e-test-automation
```

### 2. Instale as depend√™ncias

```bash
npm install
```

Isso instalar√° todas as depend√™ncias listadas no `package.json`:

- Cypress
- AJV
- Allure plugins
- Outras depend√™ncias de desenvolvimento

### 3. Verifique a instala√ß√£o

```bash
npx cypress verify
```

Voc√™ deve ver uma mensagem de sucesso confirmando que o Cypress est√° instalado corretamente.

---

## ‚öôÔ∏è Configura√ß√£o

### Vari√°veis de Ambiente

1. Copie o arquivo de exemplo:

```bash
cp .env.example .env
```

2. Edite o arquivo `.env` com suas configura√ß√µes:

```env
# URL base da API ServeRest
CYPRESS_BASE_URL=https://serverest.dev

# Credenciais opcionais (se necess√°rio para autentica√ß√£o)
CYPRESS_USER_EMAIL=
CYPRESS_USER_PASSWORD=
```

**Nota**: O arquivo `.env` n√£o √© versionado (est√° no `.gitignore`) para proteger informa√ß√µes sens√≠veis.

### Configura√ß√£o do Cypress

O arquivo `cypress.config.js` j√° est√° configurado com:

- ‚úÖ Base URL configur√°vel via ambiente
- ‚úÖ Retries em caso de falhas transit√≥rias
- ‚úÖ Timeouts otimizados para APIs
- ‚úÖ Desabilita√ß√£o de v√≠deos (economia de recursos)
- ‚úÖ Integra√ß√£o com Allure Reports

---

## üöÄ Executando os Testes

### Scripts Dispon√≠veis

#### Executar testes individuais

Cada script executa um spec espec√≠fico e **automaticamente gera e abre o relat√≥rio Allure**:

```bash
# Teste de cria√ß√£o de usu√°rios (POST)
npm run test:post

# Teste de listagem de usu√°rios (GET)
npm run test:get

# Teste de busca por ID (GET by ID)
npm run test:get:byid

# Teste de exclus√£o de usu√°rios (DELETE)
npm run test:delete
```

#### Executar todos os testes em sequ√™ncia

```bash
# Executa todos os specs na ordem num√©rica
npm run test:all
```

**Ordem de execu√ß√£o:**
1. POST /usuarios (14 testes)
2. GET /usuarios (23 testes)
3. GET /usuarios/{_id} (12 testes)
4. DELETE /usuarios/{_id} (5 testes)

**Total: 54 testes**

#### Abrir Cypress GUI (modo interativo)

Para debug e desenvolvimento:

```bash
npm run cy:open
```

---

## üìä Estrutura dos Testes

### Cobertura Atual

| Endpoint | M√©todo | Testes Positivos | Testes Negativos | Total |
|----------|--------|------------------|------------------|-------|
| `/usuarios` | POST | 2 | 12 | 14 |
| `/usuarios` | GET | 9 | 14 | 23 |
| `/usuarios/{_id}` | GET | 4 | 8 | 12 |
| `/usuarios/{_id}` | DELETE | 4 | 1 | 5 |
| **TOTAL** | - | **19** | **35** | **54** |

### Tipos de Valida√ß√£o

Cada teste valida:

- ‚úÖ **Status HTTP**: C√≥digo de status esperado
- ‚úÖ **Headers**: Headers de seguran√ßa e content-type
- ‚úÖ **Schema JSON**: Conformidade com contrato usando AJV
- ‚úÖ **Mensagens de erro**: Valida√ß√£o de mensagens de erro espec√≠ficas
- ‚úÖ **Dados**: Valida√ß√£o de campos obrigat√≥rios e formatos

### Tags Utilizadas

- `@positive` - Testes de casos de sucesso
- `@negative` - Testes de casos de erro
- `@smoke` - Testes cr√≠ticos para smoke testing

---

## üìà Relat√≥rios

### Allure Reports

Ap√≥s cada execu√ß√£o, o relat√≥rio Allure √© gerado e aberto automaticamente no navegador.

#### O que voc√™ encontra no relat√≥rio:

- üìä **Dashboard**: Vis√£o geral dos testes executados
- ‚úÖ **Resultados detalhados**: Status de cada teste
- ‚è±Ô∏è **M√©tricas de tempo**: Dura√ß√£o de execu√ß√£o
- üìù **Logs**: Logs detalhados de cada passo
- üì∏ **Evid√™ncias**: Screenshots e dados capturados
- üìâ **Tend√™ncias**: Hist√≥rico de execu√ß√µes

#### Acessar relat√≥rio manualmente

Se necess√°rio, voc√™ pode gerar ou abrir o relat√≥rio manualmente:

```bash
# Limpar resultados anteriores
npm run allure:clean

# Gerar relat√≥rio
npm run allure:generate

# Abrir relat√≥rio no navegador
npm run allure:open
```

**Localiza√ß√£o**: `reports/allure-report/index.html`

---

## üìù Padr√µes de C√≥digo

### Conven√ß√µes de Nomenclatura

- **Arquivos de teste**: `{numero}-{acao}.{recurso}.spec.cy.js`
- **Fun√ß√µes helper**: `camelCase` (ex: `assertTypicalJsonHeaders`)
- **Constantes**: `camelCase` ou `UPPER_SNAKE_CASE`
- **Vari√°veis**: `camelCase`

### Estrutura de um Teste

```javascript
// 1. Imports
import { assertTypicalJsonHeaders, validateSchema } from '../support/helpers.js';

// 2. Setup do describe
describe('API /usuarios :: CRIA√á√ÉO', () => {
  let fx; // Fixtures
  
  before(() => {
    // Carregar fixtures, schemas, etc.
  });

  // 3. Testes negativos primeiro
  it('CT-001 ‚Äî [400] Caso negativo @negative', () => {
    // Arrange
    const payload = fx.CT001_data;
    
    // Act
    cy.request({ method: 'POST', url: '/usuarios', body: payload, failOnStatusCode: false })
      .then((res) => {
        // Assert
        expect(res.status).to.eq(400);
        assertTypicalJsonHeaders(res.headers);
      });
  });

  // 4. Testes positivos depois
  it('CT-014 ‚Äî [201] Caso positivo @positive', () => {
    // ...
  });
});
```

---

## üí° Exemplos de Uso

### Executando um teste espec√≠fico durante desenvolvimento

```bash
# Abrir Cypress GUI
npm run cy:open

# Selecionar o spec desejado e executar em modo interativo
```

### Executando apenas testes de smoke

No Cypress GUI, voc√™ pode filtrar por tags usando:

```bash
npm run cy:open
```

E ent√£o usar o filtro de busca: `@smoke`

### Verificando resultados ap√≥s execu√ß√£o

Ap√≥s executar qualquer script de teste, o relat√≥rio Allure ser√° aberto automaticamente. Voc√™ pode:

- Analisar testes falhados
- Ver detalhes de cada passo
- Exportar relat√≥rios em diferentes formatos
- Compartilhar resultados com a equipe

---

## üß™ Helpers Dispon√≠veis

### `assertTypicalJsonHeaders(headers)`

Valida headers t√≠picos de uma resposta JSON:

```javascript
import { assertTypicalJsonHeaders } from '../support/helpers.js';

cy.request({ method: 'GET', url: '/usuarios' })
  .then((res) => {
    assertTypicalJsonHeaders(res.headers);
    // Valida: content-type, x-content-type-options, x-xss-protection, strict-transport-security
  });
```

### `validateSchema(body, schema)`

Valida se o body da resposta est√° conforme o schema JSON:

```javascript
import { validateSchema } from '../support/helpers.js';

const schema = {
  type: 'object',
  required: ['message', '_id'],
  properties: {
    message: { type: 'string' },
    _id: { type: 'string' }
  }
};

cy.request({ method: 'POST', url: '/usuarios', body: payload })
  .then((res) => {
    validateSchema(res.body, schema);
  });
```

### `generateUniqueEmail(prefix)`

Gera email √∫nico com timestamp:

```javascript
import { generateUniqueEmail } from '../support/helpers.js';

const email = generateUniqueEmail('admin'); 
// Resultado: admin_1234567890@serverest.dev
```

---

## üîß Troubleshooting

### Problema: Testes falhando com timeout

**Solu√ß√£o**: Verifique se a API est√° acess√≠vel:

```bash
curl https://serverest.dev/status
```

### Problema: Allure n√£o abre automaticamente

**Solu√ß√£o**: Abra manualmente:

```bash
npm run allure:open
```

### Problema: Erro ao instalar depend√™ncias

**Solu√ß√£o**: Limpe o cache e reinstale:

```bash
rm -rf node_modules package-lock.json
npm install
```

---

## üìö Recursos Adicionais

- [Documenta√ß√£o do Cypress](https://docs.cypress.io/)
- [Documenta√ß√£o do ServeRest](https://serverest.dev/)
- [Documenta√ß√£o do Allure](https://docs.qameta.io/allure/)
- [AJV - JSON Schema Validator](https://ajv.js.org/)

---

## üìÑ Licen√ßa

Este projeto est√° licenciado sob a licen√ßa ISC.

---

## üë§ Autor

**Thito Ribeiro**

- GitHub: [@thitoribeiro](https://github.com/thitoribeiro)

---

## üôè Agradecimentos

- [ServeRest Latina](https://serverest.dev/) pela API de teste p√∫blica
- Comunidade Cypress pelo excelente framework
- Equipe Allure pelos relat√≥rios detalhados

